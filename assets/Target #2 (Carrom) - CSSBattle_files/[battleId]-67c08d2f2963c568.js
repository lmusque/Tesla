(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[789],{9249:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle/[battleId]",function(){return a(8391)}])},8432:function(e,t,a){"use strict";var n=a(2322),s=a(8724),r=a(4030);t.Z=function(e){var t=e.alignMenuRight,a=e.isCSSLeaderboard,i=e.setIsCSSLeaderboard,l=e.levelId,o=e.battleId;return(0,r.isNonCssAvailable)({levelId:l,battleId:o})?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(s.L,{alignRight:t,isFixed:!0,dropdownBtnClasses:"dropdown-btn--small  dropdown-btn--leaderboard-switch ".concat(a?"":"dropdown-btn--primary"),dropdownMenuClasses:"dropdown-menu--no-padding dropdown-menu--small",dropdownBtnContent:a?"CSS":"ALL",children:(0,n.jsxs)("div",{style:{minWidth:"22rem"},children:[(0,n.jsxs)("div",{className:"dropdown-selector",onClick:function(){return i(!0)},children:[(0,n.jsx)("span",{className:"small-pill",children:"CSS"}),(0,n.jsx)("p",{children:"Leaderboard only includes pure CSS solutions. Great for beginners"})]}),(0,n.jsxs)("div",{className:"dropdown-selector",onClick:function(){return i(!1)},children:[(0,n.jsx)("span",{className:"small-pill small-pill--primary",children:"ALL"}),(0,n.jsx)("p",{children:"Leaderboard includes all solutions (SVG-in-CSS, Unicode, and CSS). Great for advanced players"})]})]})})}):null}},9411:function(e,t,a){"use strict";a.d(t,{L:function(){return i}});var n=a(6383),s=a(4030),r=a(9318);function i(e){var t=e.levelId,a=e.battleId,i=(0,n.Z)((0,r._)("showCSSLeaderboard",!0),2),l=i[0],o=i[1];return(0,s.isNonCssAvailable)({levelId:t,battleId:a})?[l,o]:[!0,function(){}]}},8391:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return X}});var n=a(2322),s=a(2784),r=a(5632),i=a(7729),l=a.n(i),o=a(7500),c=a(4697),d=a(7171),u=a(865),h=a(6670),m=a(6383),p=a(930),f=a(1453),g=a(7037),x=a(8742),j=a(3552),b=a(9241),v=a(9318),N=a(94),y=a(1942),S=a(9097),_=a.n(S),w=a(8432),I=a(9411),k=function(e){var t=e.title,a=e.battleId,r=e.numOfPlayersToShow,i=void 0===r?10:r,l=(0,s.useContext)(j.S),c=(0,s.useState)([]),d=c[0],S=c[1],k=(0,s.useState)({}),C=k[0],B=k[1],L=(0,s.useState)(),F=L[0],O=L[1],E=(0,m.Z)((0,v._)("showFriendsLeaderboard",!!l),2),P=E[0],D=E[1],T=(0,m.Z)((0,I.L)({battleId:a}),2),G=T[0],Z=T[1],A=(0,o.checkIfCustomBattle)({id:a}),M=(0,s.useState)({battlePlayerCount:{}}),R=M[0],z=M[1];return(0,s.useEffect)((function(){(0,g.pc)().then(z)}),[]),(0,s.useEffect)((function(){O(!0),S([]),B({}),(P&&l?(0,g.eL)({battleId:a,userId:l.uid,isCSSLeaderboard:G}):(0,g.uL)({battleId:a,numberOfPlayers:i,isCSSLeaderboard:G})).then((function(e){G||e.map((function(e){var t,a;e.score=null===(t=e.overall)||void 0===t?void 0:t.score,e.lastUpdated=null===(a=e.overall)||void 0===a?void 0:a.lastUpdated})),S(e),O(!1),l&&e.length&&(e.find((function(e){return e.id===l.uid}))?B({rank:e.findIndex((function(e){return e.id===l.uid}))+1}):(0,g.r8)({userId:l.uid,battleId:a}).then((function(t){B(t),S((0,p.Z)(e).concat([{score:t.score,playerProfile:(0,h.Z)((0,u.Z)({},l),{avatar:l.photoURL}),id:l.uid,rank:t.rank,playedCount:t.playedCount}]))})).catch((function(e){console.log("failed to fetch rank")})))}))}),[l?l.uid:"",a,P,G]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.M,{extraContent:(0,n.jsx)(w.Z,{battleId:a,alignMenuRight:!0,isCSSLeaderboard:G,setIsCSSLeaderboard:Z}),meta:"You: ".concat(C.rank||"-","/").concat(P?d.length:R.battlePlayerCount[a]||"-"),children:t}),(0,n.jsxs)("div",{className:"item__content",children:[l&&(0,n.jsx)(N.g,{isFriendsMode:P,onChange:function(e){D("friends"===e.target.value)}}),P&&!F&&!d.length&&(0,n.jsx)(y.N,{}),0===C.rank&&(0,n.jsx)("p",{className:"section-helper section-helper--no-score",children:"Play at least 1 target to see your rank."}),(0,n.jsxs)("div",{className:"leaderboard-container",children:[F?(0,n.jsx)("p",{className:"ta-c",children:(0,n.jsx)(b.a,{})}):null,!F&&!d.length&&!P&&(0,n.jsx)("p",{className:"para",children:"No one here. It could be you! How about playing some targets?"}),(0,n.jsx)("ol",{className:"leaderboard__user-list",children:d.map((function(e,t){return(0,n.jsx)("li",{children:(0,n.jsx)(x.P,{data:(0,h.Z)((0,u.Z)({},e),{rank:void 0===e.rank?t+1:e.rank})},t)},t)}))})]}),d.length?(0,n.jsxs)("p",{className:"para leaderboard-buttons",children:[(0,n.jsx)(_(),{href:"/leaderboard/battle/".concat(a),children:(0,n.jsx)("a",{className:"button",children:"See top 100"})}),!A&&(0,n.jsx)(_(),{href:"/leaderboard",children:(0,n.jsx)("a",{className:"button",style:{marginLeft:"1rem"},children:"All-time leaderboard"})})]}):null]})]})},C=a(1251),B=a(1551);function L(e){var t,a=e.data,r=e.playerData,i=void 0===r?{}:r,l=e.stats,o=e.unlockDate,c=(0,s.useContext)(j.S),d=(0,s.useState)(!a.id),u=d[0],h=d[1];a.image=u?a.isOpen?"/targets/0-open.png":"/targets/0.png?v=2":a.image;var m=null===(t=a.image)||void 0===t?void 0:t.replace(/\.png/,"@2x.png");return(0,s.useEffect)((function(){h(!a.id)}),[a.id]),(0,n.jsxs)("div",{className:"target-tile ".concat(a.id?"":"target-tile--dummy"," ").concat(a.isOpen?"target-tile--public":""),children:[a.id&&(0,n.jsx)(_(),{href:"/play/".concat(a.id),children:(0,n.jsx)("a",{className:"shadow-link",title:"Play target number ".concat(a.id)})}),(0,n.jsx)("img",{src:a.image,srcSet:"".concat(m," 2x"),alt:"",loading:"lazy",className:"target-tile__image"}),(0,n.jsxs)("div",{className:"target-tile__info",children:[(0,n.jsxs)("div",{className:"target-top-info",children:[a.id?(0,n.jsx)("p",{className:"target-top-info__pill",children:a.id.length>5&&a.name||"#".concat(a.id)}):null,a.isOpen?(0,n.jsx)("p",{className:"target-top-info__pill",children:(0,n.jsx)("img",{alt:"",src:"/images/open-book.svg"})}):null]}),(0,n.jsxs)("div",{className:"target-highscore",children:[l?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"target-highscore__right",children:[(0,n.jsx)("div",{className:"target-highscore__username",children:(0,n.jsx)(C.Rj,{name:l.highscore.playerProfile.displayName,username:l.highscore.playerProfile.username,userId:l.highscore.playerProfile.userId,isPro:l.highscore.playerProfile.isPro,ellipsis:!0})}),(0,n.jsxs)("p",{className:"target-highscore__score",children:[l.highscore.score," ",(0,n.jsxs)("span",{children:["{",l.highscore.codeSize,"}"]})]})]}),(0,n.jsx)(C.qE,{small:!0,size:"40",url:l.highscore.playerProfile.avatar,userId:l.highscore.playerProfile.userId,username:l.highscore.playerProfile.username,className:"target-highscore__avatar"})]}):null,l||u?null:"No highscore available",u&&o?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"target-highscore__right",children:[(0,n.jsx)("div",{className:"target-highscore__username",children:"Unlocks in:"}),(0,n.jsx)("div",{className:"target-highscore__score",children:(0,n.jsx)(B.W,{date:o,suffix:"",prefix:""})})]})}):null]}),c&&!u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"target-tile-header",children:"Your Stats"}),(0,n.jsx)("div",{className:"target-attempts",children:(0,n.jsxs)("p",{className:"target-attempts__item target-attempts__item--score",children:["Score:",(0,n.jsxs)("span",{children:[i.score||"N/A"," ",(0,n.jsxs)("span",{children:["{",i.codeSize||"-","}"]})]})]})})]})]}),a.isOpen?(0,n.jsx)("div",{className:"public-target-message",children:(0,n.jsxs)("p",{children:['This is an "Open" Target. Open Targets have all the top solutions public.'," ",(0,n.jsx)("a",{className:"link",href:"/blog/introducing-open-targets/",children:"Learn More"})]})}):null]})}function F(e){var t=(0,s.useState)(),a=t[0],r=t[1],i=(0,s.useState)(),l=i[0],o=i[1];return(0,s.useEffect)((function(){if(r(),o(),e.data.id){var t=e.data.id;return(0,g.GT)(e.data.id).then((function(a){t===e.data.id&&r(a)})),function(){t=null}}}),[e.data.id]),(0,s.useEffect)((function(){var t=Math.floor(e.index/2),a=new Date(e.battleStartDate);a.setDate(a.getDate()+7*t),o(a)}),[e.data.id]),(0,n.jsx)(L,(0,h.Z)((0,u.Z)({},e),{stats:a,unlockDate:l}))}var O="all",E="played",P="notPlayed";function D(e){var t=e.battle,a=function(e){y(e.target.value)},r=(0,s.useContext)(j.S),i=(0,s.useState)([]),l=i[0],o=i[1],c=(0,s.useState)(),d=c[0],m=c[1],p=(0,s.useState)(0),x=p[0],b=p[1],v=(0,s.useState)(O),N=v[0],y=v[1];return(0,s.useEffect)((function(){(0,g.TU)(t.levelIds).then(o)}),[t.id]),(0,s.useEffect)((function(){b(0),m(),r&&(0,g.HC)({userId:r.uid,levelIds:t.levelIds}).then((function(e){b(Object.keys(e).length),m(e)}))}),[r?r.uid:"",t.id]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.M,{sticky:!0,meta:r?(0,n.jsx)("div",{children:(0,n.jsxs)("span",{className:"filter",children:[(0,n.jsxs)("span",{className:"filter__button",children:[(0,n.jsx)("input",{defaultChecked:!0,type:"radio",name:"filter",id:"all",value:O,onChange:a}),(0,n.jsxs)("label",{htmlFor:"all",children:["All (","".concat(t.levelIds.length),")"]})]}),(0,n.jsxs)("span",{className:"filter__button",children:[(0,n.jsx)("input",{type:"radio",name:"filter",id:"played",value:E,onChange:a}),(0,n.jsxs)("label",{htmlFor:"played",children:["Played (","".concat(x),")"]})]}),(0,n.jsxs)("span",{className:"filter__button",children:[(0,n.jsx)("input",{type:"radio",name:"filter",id:"notPlayed",value:P,onChange:a}),(0,n.jsxs)("label",{htmlFor:"notPlayed",children:["Not yet played (","".concat(l.length-x),")"]})]})]})}):null,children:["Battle ",(0,n.jsx)(C.bN,{id:t.id})," - ",t.name]}),(0,n.jsx)("div",{className:"item__content",children:(0,n.jsx)("div",{className:"targets-container",children:l.map((function(e,a){return N===O||N===E&&d[e.id]||N===P&&!d[e.id]?(0,n.jsx)(F,{data:(0,h.Z)((0,u.Z)({},e),{id:e.id,isOpen:!(!t.openLevelIds||!t.openLevelIds.includes(e.id||t.firstLevelId+a))}),playerData:d?d[e.id]:void 0,index:a,totalLevels:l.length,battleStartDate:t.startDate},a):null}))})})]})}var T=a(8788),G=a(4776),Z=a.n(G),A=a(3029),M=a(1893),R=a(3290),z=a(2220),U=a(2367);function W(e){return e.endDate||+new Date(1e3*e.startDate.seconds)+60*e.duration*1e3}function Y(e){var t=e.battle,a=function(){return l&&(!l.settings||!l.settings.emailNotifications)&&!1!==u},i=function(){j((0,o.getBattleStatus)(t))},l=(0,M.a)(),c=(0,r.useRouter)(),d=(0,s.useState)(),u=d[0],h=d[1],m=(0,o.checkIfCustomBattle)(t),p=(0,s.useState)((0,o.getBattleStatus)(t)),x=p[0],j=p[1],b=(0,s.useState)(!1),v=b[0],N=b[1];function y(e){return S.apply(this,arguments)}function S(){return(S=(0,T.Z)(Z().mark((function e(a){var n;return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=6;break}return e.next=3,l.getIdToken();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0="";case 7:if(n=e.t0){e.next=10;break}return e.abrupt("return");case 10:return N(!0),e.abrupt("return",fetch("".concat(g.bl,"/").concat(a===o.BattleStatuses.ONGOING?"startBattle":"stopBattle","?token=").concat(n,"&battleId=").concat(t.id)).then((function(e){return N(!1),e})));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return _=(0,T.Z)(Z().mark((function e(){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:if(t.levelIds.length){e.next=4;break}return e.abrupt("return",window.alert("You have not added any targets yet. Add at least 1 target to before starting the battle."));case 4:if(window.confirm("You cannot edit or restart a battle once it is started. Are you sure you want to start this battle?")){e.next=7;break}return e.abrupt("return");case 7:y(o.BattleStatuses.ONGOING).then(function(){var e=(0,T.Z)(Z().mark((function e(t){var a;return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=4;break}return(0,U.lC)(3),j(o.BattleStatuses.ONGOING),e.abrupt("return");case 4:return e.next=6,t.json();case 6:if("insufficientCredits"!==(a=e.sent).error){e.next=13;break}return window.confirm("You have insufficient credits to start this custom battle. Click OK to proceed to buying credits.")&&c.push("/settings?tab=custom-battle-credits"),e.abrupt("return");case 13:if("noTargetsFound"!==a.error){e.next=16;break}return window.alert("You have not added any targets yet. Add at least 1 target to before starting the battle."),e.abrupt("return");case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){N(!1),alert("Battle could not be started. Try one more time, otherwise DM us on twitter: @css_battle")}));case 8:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}return s.useEffect((function(){j((0,o.getBattleStatus)(t))}),[t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.M,{children:[t.type?t.type===o.BattleTypes.BIG_BATTLE?"Big":"Mini":"Custom"," ","Battle"]}),(0,n.jsxs)("div",{className:"homepage-banner",children:[(0,n.jsxs)("div",{className:"d-if",style:{alignItems:"center",marginBottom:"0.25rem"},children:[(0,n.jsxs)("h1",{className:"homepage-banner__heading",style:{marginBottom:"0",marginRight:"1rem"},children:["Battle ",(0,n.jsx)(C.bN,{id:t.id})," - ",t.name]}),(0,n.jsx)(A.k,{status:x})]}),(0,n.jsxs)("div",{className:"homepage-banner__description battle-banner__description",children:[t.description?(0,n.jsxs)("p",{className:"para",children:[t.description," ",t.sponsor?(0,n.jsxs)(n.Fragment,{children:["Sponsored by"," ",(0,n.jsx)("a",{className:"link",href:t.sponsor.link,children:t.sponsor.name}),".",t.rewards?" The following rewards will be given to players at the end of the Battle.":null]}):null]}):null,t.rewards?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"battle-rewards",children:[t.rewards.gold?(0,n.jsx)("div",{className:"reward-tile reward-tile--gold",children:t.rewards.gold}):null,t.rewards.silver?(0,n.jsx)("div",{className:"reward-tile reward-tile--silver",children:t.rewards.silver}):null,t.rewards.bronze?(0,n.jsx)("div",{className:"reward-tile reward-tile--bronze",children:t.rewards.bronze}):null,t.rewards.others?(0,n.jsx)("div",{className:"reward-tile reward-tile--regular",children:t.rewards.others}):null]}),(0,n.jsx)("p",{style:{fontSize:"12px",marginTop:"-30px"},children:t.rewards.note})]}):null]}),x===o.BattleStatuses.UPCOMING&&t.startDate?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.xu,{style:{padding:"0.6rem 1.5rem"},children:(0,n.jsx)(B.W,{date:t.startDate,onFinish:i})}),(0,n.jsxs)("p",{className:"para",children:["Starting on ",new Date(t.startDate).toLocaleString()]})]}):null,x===o.BattleStatuses.FINISHED&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"para",style:{marginLeft:"2rem",marginRight:"2rem"},children:m?"This Battle has finished. But you can always play the targets below. Note: Custom battle targets don't  contribute to your global ranking.":"This Battle has finished. But you can always play the targets below and improve your global ranking!"}),a()&&(0,n.jsx)(z.z,{primary:!0,onClick:function(){h(!0),(0,R.q)({name:"emailNotificationUpdated",label:1}),(0,g.Ii)(l.uid,{"settings.emailNotifications":!0}).then((function(){h(!1)}))},isLoading:u,children:"Get Notified via Email about new Battles"}),!1===u?(0,n.jsx)("p",{className:"para",children:"Great! We'll notify you about coming Battles."}):null,a()&&(0,n.jsx)("p",{className:"small",style:{margin:"2rem 2rem 0",color:"var(--clr-text-light)"},children:"With this, you'll also receive future emails from us regarding such announcements. We won't spam you :)"})]}),x===o.BattleStatuses.ONGOING&&t.startDate?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"para",children:["Battle ends on ",new Date(W(t)).toLocaleString()]}),(0,n.jsx)(C.xu,{style:{padding:"0.6rem 1.5rem"},children:(0,n.jsx)(B.W,{date:W(t),onFinish:i})})]}):null,!l&&(0,n.jsx)("p",{children:(0,n.jsx)("a",{className:"button",href:"/login",children:"Sign In / Sign Up"})}),l&&l.uid===t.createdBy?(0,n.jsxs)(C.hE,{center:!0,children:[x===o.BattleStatuses.UPCOMING?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(z.z,{primary:!0,onClick:function(){return _.apply(this,arguments)},isLoading:v,children:"Start Battle"}),(0,n.jsx)("a",{className:"link",href:"/battle/create/".concat(t.id),children:"Edit"})]}):null,x===o.BattleStatuses.ONGOING?(0,n.jsx)(z.z,{danger:!0,onClick:function(){window.confirm("You cannot restart a battle once it is stopped. Are you sure you want to stop this battle?")&&y(o.BattleStatuses.FINISHED).then(function(){var e=(0,T.Z)(Z().mark((function e(t){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=3;break}return j(o.BattleStatuses.FINISHED),e.abrupt("return");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){N(!1),alert("Battle could not be stopped. Try one more time, otherwise DM us on twitter: @css_battle")}))},isLoading:v,children:"Stop Battle"}):null]}):null]})]})}var H=a(7418),q=a(3781),V=a.n(q),X=function(){var e=(0,r.useRouter)(),t=(0,s.useContext)(j.S),a=(0,s.useState)(!1),i=(a[0],a[1]),u=(0,s.useState)(),h=u[0],m=u[1];(0,s.useEffect)((function(){if(e.isReady){var t=e.query.battleId,a=(0,U.NR)(t);i(a),m(a?t:parseInt(t,10))}}),[e.isReady,e.query.battleId]);var p=(0,s.useState)(),f=p[0],x=p[1];return(0,s.useEffect)((function(){h&&(0,g.ch)(h).then((function(e){(0,o.getBattleStatus)(e)!==o.BattleStatuses.UPCOMING||t&&e.createdBy===t.uid||(e.levelIds=e.levelIds.map((function(){return 0}))),x(e)}))}),[h]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:f?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("meta",{property:"og:title",content:"Battle #".concat(f.id,": ").concat(f.name," - CSSBattle")},"ogTitle"),(0,n.jsx)("title",{children:"Battle #".concat(f.id,": ").concat(f.name," - CSSBattle")},"title")]}):null}),(0,n.jsx)(c.h,{battleId:h,battleName:f?f.name:""}),f?(0,n.jsxs)("div",{className:"container",children:[(0,n.jsxs)("div",{className:"container__item container__item--main container__item--targets",children:[(0,n.jsx)(Y,{battle:f}),(0,n.jsx)(D,{battle:f})]}),(0,n.jsx)("div",{className:"container__item container__item--aside container__item--sticky",children:f?(0,n.jsxs)("div",{className:V().halfAndHalf,children:[(0,n.jsx)("div",{children:(0,n.jsx)(k,{title:"Battle Leaderboard",battleId:f.id})}),(0,n.jsx)("div",{children:(0,n.jsx)(H.E,{battleId:f.id})})]}):null})]}):(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"container__item container__item--main",children:(0,n.jsx)(b.R,{children:"Fetching battle details..."})})}),(0,n.jsx)(d.$,{})]})}},4030:function(e){e.exports={isNonCssAvailable:function({levelId:e,battleId:t}){return e?e>=141:t?t>22:void 0},NON_CSS_START_LEVEL_ID:141}}},function(e){e.O(0,[154,836,112,774,888,179],(function(){return t=9249,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[battleId]-67c08d2f2963c568.js.map